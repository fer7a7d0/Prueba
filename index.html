<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tres en raya</title>
  <style>
    :root{--bg:#1e1e2f;--card:#2a2a40;--accent:#4ade80;--muted:#cbd5e1;--win:#facc15}
    *{box-sizing:border-box;transition:all 0.2s ease}
    body{font-family:'Poppins', sans-serif; margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#1f2937 0%, #111827 100%);color:#f1f5f9}
    .wrap{width:100%;max-width:720px;padding:24px}
    .card{background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);padding:18px;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,0.4)}
    h1{margin:0 0 8px;font-size:24px;font-weight:600}
    p.lead{margin:0 0 12px;color:var(--muted);font-size:14px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.1);color:inherit;padding:8px 12px;border-radius:10px;cursor:pointer}
    button:hover{background:rgba(255,255,255,0.08)}
    button.primary{background:var(--accent);border:0;color:#042018}
    .board{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:14px;background:rgba(255,255,255,0.05);border-radius:14px}
    .cell{background:rgba(255,255,255,0.03);height:110px;display:flex;align-items:center;justify-content:center;font-size:40px;border-radius:12px;user-select:none;cursor:pointer}
    .cell:hover{background:rgba(255,255,255,0.08)}
    @media (max-width:600px){
    .wrap{padding:12px}
    h1{font-size:20px}
    .board{gap:6px;padding:10px}
    .cell{height:70px;font-size:28px}
    button{padding:6px 10px;font-size:12px}
  }}
    .status{margin-top:12px;display:flex;align-items:center;justify-content:space-between}
    .score{display:flex;gap:12px;font-size:14px;color:var(--muted)}
    .line{height:4px;background:transparent;border-radius:4px;margin-top:12px}
    .winner{color:var(--win);font-weight:600}
    .highlight{background:linear-gradient(90deg, rgba(250,204,21,0.2), rgba(250,204,21,0.1));}
    .small{font-size:13px;color:var(--muted)}
    .footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <h1>Tres en raya</h1>
          <p class="lead">Juega con otra persona o contra la IA (modo fácil). Haz clic en una casilla para colocar tu ficha.</p>
        </div>
        <div class="controls">
          <label class="small">IA:</label>
          <select id="mode">
            <option value="pvp">2 jugadores</option>
            <option value="pvc">Contra IA (fácil)</option>
          </select>
          <button id="restart">Reiniciar</button>
          <button id="resetScores">Reset scores</button>
        </div>
      </div>

      <div id="board" class="board" aria-label="Tablero tres en raya">
        <!-- 9 casillas generadas por JS -->
      </div>

      <div class="status">
        <div class="score">
          <div>Jugador X: <span id="scoreX">0</span></div>
          <div>Jugador O: <span id="scoreO">0</span></div>
          <div>Empates: <span id="scoreT">0</span></div>
        </div>
        <div>
          <div id="message" class="small">Turno de <span id="turn">X</span></div>
        </div>
      </div>

      <div class="line"></div>
      <div class="footer">Hecho con ❤️ — comentarios o mejoras bienvenidas.</div>
    </div>
  </div>

  <script>
    // Lógica del juego
    const boardEl = document.getElementById('board');
    const messageEl = document.getElementById('message');
    const turnEl = document.getElementById('turn');
    const modeEl = document.getElementById('mode');
    const restartBtn = document.getElementById('restart');
    const resetScoresBtn = document.getElementById('resetScores');
    const scoreXEl = document.getElementById('scoreX');
    const scoreOEl = document.getElementById('scoreO');
    const scoreTEl = document.getElementById('scoreT');

    let board = Array(9).fill('');
    let turn = 'X';
    let playing = true;
    let scores = { X:0, O:0, T:0 };

    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    function renderBoard(){
      boardEl.innerHTML = '';
      board.forEach((val,i)=>{
        const div = document.createElement('div');
        div.className = 'cell';
        div.dataset.index = i;
        div.setAttribute('role','button');
        div.setAttribute('aria-label', 'Casilla ' + (i+1));
        div.textContent = val;
        if(!val && playing){
          div.addEventListener('click', onCellClick);
        }
        boardEl.appendChild(div);
      });
      turnEl.textContent = turn;
    }

    function onCellClick(e){
      const i = Number(e.currentTarget.dataset.index);
      if(!playing || board[i]) return;
      makeMove(i, turn);
      if(modeEl.value === 'pvc' && playing){
        // turno de la IA simple: mueve aleatoriamente después de 300ms
        setTimeout(()=>{ aiMove(); }, 300);
      }
    }

    function makeMove(index, player){
      if(board[index] || !playing) return;
      board[index] = player;
      checkState();
      if(playing) switchTurn();
      renderBoard();
    }

    function switchTurn(){ turn = (turn === 'X') ? 'O' : 'X'; turnEl.textContent = turn; }

    function checkState(){
      // comprobar victoria
      for(const [a,b,c] of wins){
        if(board[a] && board[a] === board[b] && board[b] === board[c]){
          // hay ganador
          playing = false;
          highlightWinning([a,b,c]);
          messageEl.innerHTML = 'Ganador: <span class="winner">' + board[a] + '</span>';
          scores[board[a]]++;
          updateScores();
          return;
        }
      }
      // comprobar empate
      if(board.every(cell => cell)){
        playing = false;
        messageEl.textContent = 'Empate.';
        scores.T++;
        updateScores();
      }
    }

    function highlightWinning(indices){
      indices.forEach(i=>{
        const el = boardEl.querySelector('[data-index="'+i+'"]');
        if(el) el.classList.add('highlight');
      });
    }

    function updateScores(){
      scoreXEl.textContent = scores.X;
      scoreOEl.textContent = scores.O;
      scoreTEl.textContent = scores.T;
    }

    function restart(){
      board = Array(9).fill('');
      turn = 'X';
      playing = true;
      messageEl.textContent = 'Turno de ' + turn;
      renderBoard();
    }

    function resetScores(){ scores = {X:0,O:0,T:0}; updateScores(); }

    // IA simple: elige una casilla libre al azar.
    function aiMove(){
      if(!playing) return;
      const free = board.map((v,i)=> v ? null : i).filter(v=>v!==null);
      if(!free.length) return;
      // Intentar una jugada ganadora o bloquear al oponente (heurística sencilla)
      let chosen = null;

      // 1) ¿puede IA (O) ganar ahora?
      chosen = findWinningMove('O');
      // 2) ¿debe bloquear a X?
      if(chosen === null) chosen = findWinningMove('X');
      // 3) si no, esquina centro esquina.
      if(chosen === null){
        const preferred = [4,0,2,6,8,1,3,5,7];
        chosen = preferred.find(i=> board[i]==='');
      }
      if(chosen!==null) makeMove(chosen,'O');
    }

    function findWinningMove(player){
      for(const [a,b,c] of wins){
        const vals = [board[a], board[b], board[c]];
        if(vals.filter(v=>v===player).length===2 && vals.includes('')){
          const emptyIndex = [a,b,c].find(i=> board[i]==='');
          return emptyIndex;
        }
      }
      return null;
    }

    // listeners
    restartBtn.addEventListener('click', ()=>{ restart(); });
    resetScoresBtn.addEventListener('click', ()=>{ resetScores(); });
    modeEl.addEventListener('change', ()=>{ restart(); });

    // inicialización
    renderBoard();

  </script>
</body>
</html>
