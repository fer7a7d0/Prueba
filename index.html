<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tres en Raya contra IA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            margin: 0;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, minmax(80px, 20vw));
            grid-gap: 0.5rem;
            margin-top: 2rem;
        }
        .cell {
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            background-color: white;
            border: 2px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(2rem, 5vw, 3rem);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .cell:hover {
            background-color: #e0e0e0;
        }
        .cell.winner {
            background-color: #4CAF50;
            color: white;
        }
        #status {
            font-size: 1.5rem;
            margin-top: 1rem;
        }
        #scores {
            font-size: 1.2rem;
            margin-top: 0.5rem;
        }
        #restart {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        #restart:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Tres en Raya contra IA</h1>
    <div id="status">Turno del jugador: X</div>
    <div id="scores">Jugador: 0 | IA: 0</div>
    <div class="board" id="board">
        <div class="cell" data-index="0" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="1" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="2" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="3" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="4" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="5" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="6" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="7" role="button" aria-label="Celda vacía" tabindex="0"></div>
        <div class="cell" data-index="8" role="button" aria-label="Celda vacía" tabindex="0"></div>
    </div>
    <button id="restart">Reiniciar Juego</button>

    <script>
        const TicTacToe = {
            board: ['', '', '', '', '', '', '', '', ''],
            gameActive: true,
            currentPlayer: 'X',
            statusElement: document.getElementById('status'),
            scoresElement: document.getElementById('scores'),
            cells: document.querySelectorAll('.cell'),
            winningCombinations: [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Filas
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columnas
                [0, 4, 8], [2, 4, 6] // Diagonales
            ],
            scores: {
                player: parseInt(localStorage.getItem('playerScore') || '0'),
                ai: parseInt(localStorage.getItem('aiScore') || '0')
            },

            init() {
                console.log('Iniciando juego...');
                if (!this.statusElement || !this.scoresElement || this.cells.length !== 9) {
                    console.error('Error: Elementos del DOM no encontrados.');
                    return;
                }
                this.cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    console.log(`Añadiendo listener a celda ${cell.getAttribute('data-index')}`);
                    cell.addEventListener('click', () => {
                        console.log(`Clic en celda ${cell.getAttribute('data-index')}`);
                        this.handleCellClick(cell);
                    });
                    cell.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            console.log(`Tecla presionada en celda ${cell.getAttribute('data-index')}`);
                            this.handleCellClick(cell);
                        }
                    });
                });
                document.getElementById('restart').addEventListener('click', () => {
                    console.log('Reiniciando juego...');
                    this.restartGame();
                });
                this.updateScores();
                this.updateStatus();
            },

            handleCellClick(cell) {
                console.log(`Estado: gameActive=${this.gameActive}, currentPlayer=${this.currentPlayer}`);
                if (!this.gameActive || this.currentPlayer !== 'X') {
                    console.log('Movimiento bloqueado: Juego inactivo o no es turno del jugador');
                    return;
                }
                const index = parseInt(cell.getAttribute('data-index'));
                if (isNaN(index) || index < 0 || index > 8 || this.board[index] !== '') {
                    console.log(`Movimiento inválido: index=${index}, celda=${this.board[index]}`);
                    return;
                }
                console.log(`Jugador coloca X en celda ${index}`);
                this.makeMove(index, 'X');
                if (this.gameActive) {
                    this.currentPlayer = 'O';
                    this.aiMove();
                }
            },

            makeMove(index, player) {
                this.board[index] = player;
                this.cells[index].textContent = player;
                this.cells[index].setAttribute('aria-label', `Celda ocupada por ${player}`);
                if (this.checkWin(player)) {
                    this.statusElement.textContent = `¡${player === 'X' ? 'Jugador' : 'IA'} gana!`;
                    this.updateScores(player === 'X' ? 'player' : 'ai');
                    this.gameActive = false;
                } else if (this.board.every(cell => cell !== '')) {
                    this.statusElement.textContent = '¡Empate!';
                    this.gameActive = false;
                } else {
                    this.updateStatus();
                }
            },

            aiMove() {
                console.log('Turno de la IA...');
                this.cells.forEach(cell => cell.style.pointerEvents = 'none');
                const bestMove = this.getBestMove();
                if (bestMove !== null) {
                    console.log(`IA coloca O en celda ${bestMove}`);
                    this.makeMove(bestMove, 'O');
                    this.currentPlayer = 'X';
                }
                this.cells.forEach(cell => cell.style.pointerEvents = 'auto');
            },

            getBestMove() {
                let bestScore = -Infinity;
                let bestMove = null;
                for (let i = 0; i < this.board.length; i++) {
                    if (this.board[i] === '') {
                        this.board[i] = 'O';
                        const score = this.minimax(this.board, 0, false);
                        this.board[i] = '';
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = i;
                        }
                    }
                }
                return bestMove;
            },

            minimax(board, depth, isMaximizing) {
                const winner = this.checkWin('O') ? 10 - depth : this.checkWin('X') ? depth - 10 : board.every(cell => cell !== '') ? 0 : null;
                if (winner !== null) return winner;

                if (isMaximizing) {
                    let bestScore = -Infinity;
                    for (let i = 0; i < board.length; i++) {
                        if (board[i] === '') {
                            board[i] = 'O';
                            const score = this.minimax(board, depth + 1, false);
                            board[i] = '';
                            bestScore = Math.max(score, bestScore);
                        }
                    }
                    return bestScore;
                } else {
                    let bestScore = Infinity;
                    for (let i = 0; i < board.length; i++) {
                        if (board[i] === '') {
                            board[i] = 'X';
                            const score = this.minimax(board, depth + 1, true);
                            board[i] = '';
                            bestScore = Math.min(score, bestScore);
                        }
                    }
                    return bestScore;
                }
            },

            checkWin(player) {
                for (const combination of this.winningCombinations) {
                    if (combination.every(index => this.board[index] === player)) {
                        combination.forEach(index => this.cells[index].classList.add('winner'));
                        return true;
                    }
                }
                return false;
            },

            restartGame() {
                this.board = ['', '', '', '', '', '', '', '', ''];
                this.gameActive = true;
                this.currentPlayer = 'X';
                this.cells.forEach(cell => {
                    cell.textContent = '';
                    cell.classList.remove('winner');
                    cell.setAttribute('aria-label', 'Celda vacía');
                    cell.style.pointerEvents = 'auto';
                });
                this.updateStatus();
            },

            updateStatus() {
                this.statusElement.textContent = `Turno del ${this.currentPlayer === 'X' ? 'Jugador (X)' : 'IA (O)'}`;
            },

            updateScores(winner) {
                if (winner) {
                    this.scores[winner]++;
                    localStorage.setItem('playerScore', this.scores.player);
                    localStorage.setItem('aiScore', this.scores.ai);
                }
                this.scoresElement.textContent = `Jugador: ${this.scores.player} | IA: ${this.scores.ai}`;
            }
        };

        TicTacToe.init();
    </script>
</body>
</html>